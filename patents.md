# Patent Data Analysis Scripts

Collection of Python scripts within Jupyter notebooks for searching, downloading, and analyzing patent data from various sources like the European Patent Office (EPO), Lens.org, and PubChem.
Result files are in the result_files folder
## Scripts Overview

### 1. `epo_final.ipynb`

This notebook provides a complete system to search and retrieve comprehensive patent data from the European Patent Office (EPO) using their Open Patent Services (OPS) API.

**Features:**
- Searches for patents using a specific query.
- Retrieves detailed information for each patent, including:
    - Title, Abstract, and Claims
    - Inventors and Applicants
    - Publication and Priority Dates
- Fetches INPADOC patent family data to identify related patents across different jurisdictions.
- Saves the compiled data into a single, well-structured CSV file.

**How to Run:**
1.  **API Credentials**: Open the `epo_final.ipynb` notebook. In the final cell, replace the placeholder values for `CONSUMER_KEY` and `CONSUMER_SECRET` with your own EPO OPS API credentials.
2.  **Configure Search**: In the same cell, modify the following variables:
    - `search_query`: Set this to your desired search term. Examples include a technology keyword (`"Alpha-2-macroglobulin"`) or an applicant name (`'pa = "CYTONICS CORP"'`).
    - `max_results`: Adjust the number of patents you want to retrieve.
3.  **Execute**: Run all the cells in the notebook. The script will fetch the data and save it to a CSV file named according to the search query.

**Generated Files:**
-   `EPO_Patent_Dataset_[search_query].csv`: A comprehensive CSV file containing the fetched patent data. For example, `EPO_Patent_Dataset_Alpha-2-macroglobulin.csv`.
    -   **Key Columns**: `publication_number`, `title`, `abstract`, `claims`, `inventors`, `applicants`, `inpadoc_family_size`, `inpadoc_jurisdiction_list`, `inpadoc_family_members`.
    -   Multi-value fields like inventors and family members are separated by `||`.

### 2. `final_lens_family.ipynb`

This notebook is a multi-step pipeline that uses the Lens.org API and a Generative AI model to find, filter, and visualize patent families.

**Features:**
- **Part 1: Data Fetching**: Searches Lens.org for patents based on a query and downloads the data in three different ways: grouped by simple family, expanded by simple family, and expanded by extended family.
- **Part 2: AI-Powered Filtering**: Uses the Google Gemini AI model to read the downloaded patent abstracts and titles, filter for those relevant to the biomedical field, and score their relevance to the original search query.
- **Part 3: Family Data Consolidation**: For the top-ranked patents, it traces their simple family members, fetches their details (either from the local files or via the Lens API), and creates a detailed parent-child relationship file.
- **Part 4: Data Aggregation**: Processes the family data into a final summary file where each row represents a parent patent, and all its family members' details are listed in columns, separated by `||`.
- **Part 5: Visualization**: Generates an interactive HTML network graph that visualizes the family relationships between the top patents.

**How to Run:**
1.  **API Key**: Open `final_lens_family.ipynb`. In the second cell, replace the placeholder value for `os.environ["GOOGLE_API_KEY"]` with your Google AI API key.
2.  **Configure Search**:
    - In the first cell, set the `search_query` variable to your desired term (e.g., `"Cytonics CORP"`).
    - In the second cell, ensure the `SEARCH_QUERY` variable matches the one from the first cell. You can also adjust `K_MOST_RELEVANT` to change how many top patents are selected for the final output.
3.  **Execute Cells Sequentially**: Run each cell in the notebook from top to bottom. Each cell depends on the output files generated by the previous one.

**Generated Files:**
-   `lens_patent_data_simple_family.csv`: The main output, where each row is a parent patent and columns contain `||`-separated lists of its family members' details (Lens ID, Jurisdiction, Application Number, etc.).
-   `patent_family_tree_[search_query].html`: An interactive HTML file that visualizes the patent family relationships as a network graph. For example, `patent_family_tree_Cytonics_CORP.html`.
-   **Intermediate Files**: The script also produces several intermediate files like `lens-export-*.csv`, `filtered_relevant_patents.csv`, and `simple_patent_family.csv`, which are used in subsequent steps.

### 3. `pubchem.ipynb`

This notebook is designed to scrape patent information related to chemical substances from the PubChem database.

**Features:**
- Searches for a substance on PubChem to find its Substance ID (SID).
- Scrapes the substance's page and related pages for patent numbers (e.g., US, EP, WO patents).
- Attempts to use PubChem's download services to get structured data that may contain patent information.
- Compiles all found patent numbers into a single list and saves them to a CSV file.

**How to Run:**
1.  **Configure Search**: Open the `pubchem.ipynb` notebook. In the `main()` function at the bottom of the script, change the `query` variable to the name of the substance you are interested in (e.g., `"alpha-2-macroglobulin"`).
2.  **Execute**: Run all the cells. The script will perform the search and scraping, and if any patents are found, it will save them to a CSV file.

**Generated Files:**
-   `patents_[query]_scraped.csv` (or similar, like `pubchem_final_patents.csv`): A CSV file listing the patent publication numbers found on PubChem related to the search query.
    -   **Key Columns**: `publicationnumber`, `title`, `abstract`, `inventors`, `assignees`. The script attempts to fill in as much detail as possible, but some fields may be placeholders.
